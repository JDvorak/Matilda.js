var Matilda={};Matilda.Model=function(){function i(i){var s=[],o=5,u=[],a=[],f=0,l=0,c=0,h=0,p=0,d={};var v=function(){h=o/50};var m=function(){p=c/200};var g=function(){s=[];u=[];for(var e=0;e<o;e++){u[e]=1/o;s[e]={id:e,withWord:{},wordTotal:0}}for(w in d){y(d[w])}};var y=function(e){var t=Math.floor(Math.random()*o);e.isTopic=t;if(!s[t].withWord[e.id])s[t].withWord[e.id]=0;s[t].withWord[e.id]++;s[t].wordTotal++};var b=function(e,t,n){if(!e)return;var r={topics:s,vocab:d,documents:a};e.call(t,r,n)};this.setNumberOfTopics=function(e){o=e;v();g();return this};this.addDocument=function(e,n,r){if(e instanceof Array){if(e[0]instanceof Array){for(var i=0,o=e.length;i<o;i++){this.addDocument(e[i])}}else{var u,h={bagOfWords:[],wordCount:0,topicsCounts:[]};for(t in s){h.topicsCounts[t]=0}for(w in e){u=e[w];if(!d[u]){d[u]={id:u,isTopic:0,total:0};for(t in s){s[t].withWord[u]=0}c++;m()}y(d[u]);if(!h.topicsCounts[d[u].isTopic])h.topicsCounts[d[u].isTopic]=0;h.topicsCounts[d[u].isTopic]++;h.wordCount++;d[u].total++;l++;h.bagOfWords.push(d[u])}a.push(h);f++;b(n,r,e)}}else{throw new Error("Pre-process Your Data and Try Again.")}return this};this.train=function(e,t,n){var i,f;for(var l=0;l<e;l++){a.forEach(function(e,t){for(var n=0;n<e.wordCount;n++){f=e.bagOfWords[n];s[f.isTopic].withWord[f.id]--;s[f.isTopic].wordTotal--;i=0;for(var a=0;a<o;a++){u[a]=h+e.topicsCounts[a];u[a]*=p+s[a].withWord[f.id];u[a]/=c*h+s[a].wordTotal;i+=u[a]}f.isTopic=r(u,i);s[f.isTopic].withWord[f.id]++;s[f.isTopic].wordTotal++}for(var a=0;a<o;a++){u[a]/=i;e.topicsCounts[a]=0}e.bagOfWords.forEach(function(t){e.topicsCounts[t.isTopic]+=1})});b(t,n)}return this};this.topicCorrelations=function(){var t=e(o),r=[],i=[],s=1/(f-1),u=[];for(var l=0;l<o;l++){r[l]=0}a.forEach(function(e,t){var n=e.bagOfWords.length;i[t]=[];for(var s=0;s<o;s++){i[t][s]=Math.log((e.topicsCounts[s]+h)/(n+o*h));r[s]+=i[t][s]}});for(var l=0;l<o;l++){r[l]/=f}for(var c=0;c<f;c++){n(t,function(e,n){t[e][n]+=(i[c][e]-r[e])*(i[c][n]-r[n])},this)}console.log(r,t);n(t,function(e,n){t[e][n]*=s},this);for(var l=0;l<o;l++){u[l]=Math.sqrt(t[l][l])}n(t,function(e,n){t[e][n]/=u[e]*u[n]},this);return t};this.getWordsByTopics=function(){var e=[],t=[];for(var n=0;n<o;n++){newArray=[];for(var r in s[n].withWord){e.push([r,s[n].withWord[r]]);e.sort(function(e,t){return e[1]<t[1]?1:e[1]>t[1]?-1:0})}t[n]=e;e=[]}return t};this.getSimilarDocuments=function(e){var t=a[e].topicsCounts,n=[],r=0,i={},s;for(var o=0;o<f;o++){s=a[o].topicsCounts;for(var u=0;u<s.length;u++){r+=1/(Math.abs(t[u]-s[u])+1)}i[o]=r/s.length;r=0}for(o in i){n.push([o,i[o]]);console.log(n);n.sort(function(e,t){return e[1]<t[1]?1:e[1]>t[1]?-1:0})}return n};this.getDocuments=function(){return a};this.getTopics=function(){return s};this.getVocabulary=function(){return d};g()}var e=function(e,t){var e=e,t=t||e,n=[];for(var r=0;r<e;r++){n[r]=[];for(var i=0;i<t;i++){n[r][i]=0}}return n};var n=function(e,t,n){var r=e.length;for(var i=0;i<r;i++){for(var s=0;s<r;s++){t.call(n,i,s,e)}}};var r=function(e,t){var n=t*Math.random(),r=0;n-=e[r];while(n>0){r++;n-=e[r]}return r};return i}()